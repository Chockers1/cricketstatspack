<!-- filepath: c:\Users\rtayl\OneDrive\Rob Documents\Python Scripts\cricketstatspack\templates\subscribe.html -->
{% extends "base.html" %}

{% block title %}Subscribe{% endblock %}

{% block content %}
<h2>Subscription Plans</h2>
<p>Choose a plan to subscribe:</p>

<!-- Monthly Plan Button -->
<button id="subscribe-monthly-button">Subscribe Monthly</button>

<!-- Add Annual Plan Button -->
<button id="subscribe-annual-button">Subscribe Annually</button>

<p>Already have an account? <a href="/login">Login here</a> | <a href="/verify-security">Forgot password?</a></p>

<script>
    // Event listener for Monthly button
    document.getElementById('subscribe-monthly-button').addEventListener('click', function() {
        fetch('/create-checkout-session?plan=monthly', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // Include CSRF token if needed 
            },
            // body: JSON.stringify({}) // No body needed for GET-like POST
        })
        .then(response => response.json())
        .then(session => {
            if (session.url) {
                window.location.href = session.url;
            } else {
                console.error('Error creating monthly checkout session:', session);
                alert('Could not initiate monthly checkout. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    });

    // Add Event listener for Annual button
    document.getElementById('subscribe-annual-button').addEventListener('click', function() {
        fetch('/create-checkout-session?plan=annual', { // Use plan=annual
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                // Include CSRF token if needed
            },
            // body: JSON.stringify({}) // No body needed for GET-like POST
        })
        .then(response => response.json())
        .then(session => {
            if (session.url) {
                window.location.href = session.url;
            } else {
                console.error('Error creating annual checkout session:', session);
                alert('Could not initiate annual checkout. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    });
</script>
{% endblock %}