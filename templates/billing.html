{% extends "base.html" %}
{% block title %}Billing History{% endblock %}
{% block content %}
  <h2>Billing & Subscription</h2>
  {% if subscription %}
    <div class="card mb-4 p-3">
      <h3>Current Subscription</h3>
      <p>
        <strong>Plan:</strong> {{ subscription.plan_name }}<br/>
        <strong>Status:</strong> {{ subscription.status|capitalize }}<br/>
        <strong>Period ends:</strong> {{ subscription.current_period_end }}<br/>
        {% if next_invoice_date %}
          <strong>Next invoice date:</strong> {{ next_invoice_date }}<br/>
        {% endif %}
      </p>
      {% if portal_url %}
        <a class="btn btn-secondary" href="{{ portal_url }}" target="_blank">
          Manage Subscription
        </a>
      {% endif %}
    </div>
  {% else %}
    <p>No active subscription on file.</p>
    <p><a href="/subscribe" class="btn btn-primary">Get Premium Access</a></p>
  {% endif %}

  <h2>Past Invoices</h2>
  {% if invoices %}
    <table class="table">
      <thead>
        <tr><th>Date</th><th>Amount</th><th>Status</th><th>PDF</th></tr>
      </thead>
      <tbody>
        {% for inv in invoices %}
          <tr>
            <td>{{ inv.date }}</td>
            <td>{{ inv.amount }}</td>
            <td>{{ inv.status }}</td>
            <td><a href="{{ inv.pdf }}" target="_blank">Download</a></td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No billing records found.</p>
  {% endif %}
{% endblock %}
